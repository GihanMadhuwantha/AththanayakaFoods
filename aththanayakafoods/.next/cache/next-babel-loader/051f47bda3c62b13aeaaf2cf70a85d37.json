{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gihanmadhuwantha\\\\Desktop\\\\system_Development\\\\AththanayakaFoods\\\\aththanayakafoods\\\\pages\\\\cart.js\";\nimport Head from 'next/head';\nimport { useContext, useState, useEffect } from 'react';\nimport { DataContext } from '../store/GlobalState';\nimport CartItem from '../components/CartItem';\nimport Link from 'next/link';\nimport { getData, postData } from '../utils/fetchData';\nimport { useRouter } from 'next/router';\nimport PaypalBtn from './paypalBtn';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Cart = () => {\n  const {\n    state,\n    dispatch\n  } = useContext(DataContext);\n  const {\n    cart,\n    auth,\n    orders\n  } = state;\n  const {\n    0: total,\n    1: setTotal\n  } = useState(0);\n  const {\n    0: address,\n    1: setAddress\n  } = useState('');\n  const {\n    0: mobile,\n    1: setMobile\n  } = useState('');\n  const {\n    0: payment,\n    1: setPayment\n  } = useState(false);\n  const {\n    0: callback,\n    1: setCallback\n  } = useState(false);\n  const router = useRouter();\n  useEffect(() => {\n    const getTotal = () => {\n      const res = cart.reduce((prev, item) => {\n        return prev + item.price * item.quantity;\n      }, 0);\n      setTotal(res);\n    };\n    getTotal();\n  }, [cart]);\n  useEffect(() => {\n    const cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'));\n    if (cartLocal && cartLocal.length > 0) {\n      let newArr = [];\n      const updateCart = async () => {\n        for (const item of cartLocal) {\n          const res = await getData(`product/${item._id}`);\n          const {\n            _id,\n            title,\n            images,\n            price,\n            inStock,\n            sold\n          } = res.product;\n          if (inStock > 0) {\n            newArr.push({\n              _id,\n              title,\n              images,\n              price,\n              inStock,\n              sold,\n              quantity: item.quantity > inStock ? 1 : item.quantity\n            });\n          }\n        }\n        dispatch({\n          type: 'ADD_CART',\n          payload: newArr\n        });\n      };\n      updateCart();\n    }\n  }, [callback]);\n  const handlePayment = async () => {\n    if (!address || !mobile) return dispatch({\n      type: 'NOTIFY',\n      payload: {\n        error: 'Please add your address and mobile.'\n      }\n    });\n    setPayment(true);\n  };\n  if (cart.length === 0) return /*#__PURE__*/_jsxDEV(\"img\", {\n    className: \"img-responsive w-100\",\n    src: \"/\",\n    alt: \"not empty\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 12\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Cart Page\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-8 text-secondary table-responsive my-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-uppercase\",\n        children: \"Shopping Cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"table my-3\",\n        children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: cart.map(item => /*#__PURE__*/_jsxDEV(CartItem, {\n            item: item,\n            dispatch: dispatch,\n            cart: cart\n          }, item._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-4 my-3 text-right text-uppercase text-secondary\",\n      children: [/*#__PURE__*/_jsxDEV(\"form\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Shipping\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"address\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"address\",\n          id: \"address\",\n          className: \"form-control mb-2\",\n          value: address,\n          onChange: e => setAddress(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"mobile\",\n          children: \"Mobile\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          name: \"mobile\",\n          id: \"mobile\",\n          className: \"form-control mb-2\",\n          value: mobile,\n          onChange: e => setMobile(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: [\"Total: \", /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-danger\",\n          children: [\"Rs.\", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 24\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 13\n      }, this), payment ? /*#__PURE__*/_jsxDEV(PaypalBtn, {\n        total: total,\n        address: address,\n        mobile: mobile,\n        state: state,\n        dispatch: dispatch\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 24\n      }, this) : /*#__PURE__*/_jsxDEV(Link, {\n        href: auth.user ? '#!' : '/signin',\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"btn btn-dark my-2\",\n          onClick: handlePayment,\n          children: \"Proceed with payment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 14\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 7\n  }, this);\n};\nexport default Cart;","map":{"version":3,"names":["Head","useContext","useState","useEffect","DataContext","CartItem","Link","getData","postData","useRouter","PaypalBtn","Cart","state","dispatch","cart","auth","orders","total","setTotal","address","setAddress","mobile","setMobile","payment","setPayment","callback","setCallback","router","getTotal","res","reduce","prev","item","price","quantity","cartLocal","JSON","parse","localStorage","getItem","length","newArr","updateCart","_id","title","images","inStock","sold","product","push","type","payload","handlePayment","error","map","e","target","value","user"],"sources":["C:/Users/gihanmadhuwantha/Desktop/system_Development/AththanayakaFoods/aththanayakafoods/pages/cart.js"],"sourcesContent":["import Head from 'next/head'\r\nimport { useContext, useState, useEffect } from 'react'\r\nimport { DataContext } from '../store/GlobalState'\r\nimport CartItem from '../components/CartItem'\r\nimport Link from 'next/link'\r\nimport { getData, postData } from '../utils/fetchData'\r\nimport { useRouter } from 'next/router'\r\nimport PaypalBtn from './paypalBtn'\r\n\r\n\r\nconst Cart = () => {\r\n  const { state, dispatch } = useContext(DataContext)\r\n  const { cart, auth, orders } = state\r\n\r\n  const [total, setTotal] = useState(0)\r\n\r\n  const [address, setAddress] = useState('')\r\n  const [mobile, setMobile] = useState('')\r\n  const [payment, setPayment] = useState(false)\r\n\r\n  const [callback, setCallback] = useState(false)\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    const getTotal = () => {\r\n      const res = cart.reduce((prev, item) => {\r\n        return prev + (item.price * item.quantity)\r\n      },0)\r\n\r\n      setTotal(res)\r\n    }\r\n\r\n    getTotal()\r\n  },[cart])\r\n\r\n  useEffect(() => {\r\n    const cartLocal = JSON.parse(localStorage.getItem('__next__cart01__devat'))\r\n    if(cartLocal && cartLocal.length > 0){\r\n      let newArr = []\r\n      const updateCart = async () => {\r\n        for (const item of cartLocal){\r\n          const res = await getData(`product/${item._id}`)\r\n          const { _id, title, images, price, inStock, sold } = res.product\r\n          if(inStock > 0){\r\n            newArr.push({ \r\n              _id, title, images, price, inStock, sold,\r\n              quantity: item.quantity > inStock ? 1 : item.quantity\r\n            })\r\n          }\r\n        }\r\n\r\n        dispatch({ type: 'ADD_CART', payload: newArr })\r\n      }\r\n\r\n      updateCart()\r\n    } \r\n  },[callback])\r\n\r\n  const handlePayment = async () => {\r\n    if(!address || !mobile)\r\n    return dispatch({ type: 'NOTIFY', payload: {error: 'Please add your address and mobile.'}})\r\n    setPayment(true)\r\n  }\r\n  \r\n  if( cart.length === 0 ) \r\n    return <img className=\"img-responsive w-100\" src=\"/\" alt=\"not empty\"/>\r\n\r\n    return(\r\n      <div className=\"row mx-auto\">\r\n        <Head>\r\n          <title>Cart Page</title>\r\n        </Head>\r\n\r\n        <div className=\"col-md-8 text-secondary table-responsive my-3\">\r\n          <h2 className=\"text-uppercase\">Shopping Cart</h2>\r\n\r\n          <table className=\"table my-3\">\r\n            <tbody>\r\n              {\r\n                cart.map(item => (\r\n                  <CartItem key={item._id} item={item} dispatch={dispatch} cart={cart} />\r\n                ))\r\n              }\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"col-md-4 my-3 text-right text-uppercase text-secondary\">\r\n            <form>\r\n              <h2>Shipping</h2>\r\n\r\n              <label htmlFor=\"address\">Address</label>\r\n              <input type=\"text\" name=\"address\" id=\"address\"\r\n              className=\"form-control mb-2\" value={address}\r\n              onChange={e => setAddress(e.target.value)} />\r\n\r\n              <label htmlFor=\"mobile\">Mobile</label>\r\n              <input type=\"text\" name=\"mobile\" id=\"mobile\"\r\n              className=\"form-control mb-2\" value={mobile}\r\n              onChange={e => setMobile(e.target.value)} />\r\n            </form>\r\n\r\n            <h3>Total: <span className=\"text-danger\">Rs.{total}</span></h3>\r\n            {\r\n              payment ?<PaypalBtn\r\n              total={total}\r\n              address={address}\r\n              mobile={mobile}\r\n              state={state}\r\n              dispatch={dispatch}\r\n              />\r\n              :\r\n              <Link href={auth.user ? '#!' : '/signin'}>\r\n             <a className=\"btn btn-dark my-2\" onClick={handlePayment}>Proceed with payment</a>\r\n           </Link> \r\n\r\n            }\r\n              \r\n            \r\n            \r\n            \r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n  \r\nexport default Cart"],"mappings":"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"},"metadata":{},"sourceType":"module"}