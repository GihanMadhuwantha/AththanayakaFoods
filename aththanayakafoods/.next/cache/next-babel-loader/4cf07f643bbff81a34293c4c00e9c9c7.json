{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport connectDB from '../../../utils/connectDB';\nimport Products from '../../../models/productModel';\nimport auth from '../../../middleware/auth';\nconnectDB();\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await getProducts(req, res);\n      break;\n    case \"POST\":\n      await createProduct(req, res);\n      break;\n  }\n  class APIfeatures {\n    constructor(query, queryString) {\n      this.query = query;\n      this.queryString = queryString;\n    }\n    filtering() {\n      const queryObj = _objectSpread({}, this.queryString);\n      const excludeFields = ['page', 'sort', 'limit'];\n      excludeFields.forEach(el => delete queryObj[el]);\n      if (queryObj.category !== 'all') this.query.find({\n        category: queryObj.category\n      });\n      if (queryObj.title !== 'all') this.query.find({\n        title: {\n          $regex: queryObj.title\n        }\n      });\n      this.query.find();\n      return this;\n    }\n    sorting() {\n      if (this.queryString.sort) {\n        const sortBy = this.queryString.sort.split(',').join('');\n        this.query = this.query.sort(sortBy);\n      } else {\n        this.query = this.query.sort('-createdAt');\n      }\n      return this;\n    }\n    paginating() {\n      const page = this.queryString.page * 1 || 1;\n      const limit = this.queryString.limit * 1 || 6;\n      const skip = (page - 1) * limit;\n      this.query = this.query.skip(skip).limit(limit);\n      return this;\n    }\n  }\n});\nconst getProducts = async (req, res) => {\n  try {\n    const features = new APIfeatures(Products.find(), req.query).filtering().sorting().paginating();\n    const products = await features.query;\n\n    //const products=await Products.find()\n    res.json({\n      status: 'success',\n      result: products.length,\n      products\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};\nconst createProduct = async (req, res) => {\n  try {\n    const result = await auth(req, res);\n    if (result.role !== 'admin') return res.status(400).json({\n      err: 'Authentication is not valid.'\n    });\n    const {\n      title,\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    } = req.body;\n    if (!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0) return res.status(400).json({\n      err: 'Please add all the fields.'\n    });\n    const newProduct = new Products({\n      title: title.toLowerCase(),\n      price,\n      inStock,\n      description,\n      content,\n      category,\n      images\n    });\n    await newProduct.save();\n    res.json({\n      msg: 'Success! Created a new product'\n    });\n  } catch (err) {\n    return res.status(500).json({\n      err: err.message\n    });\n  }\n};","map":{"version":3,"names":["connectDB","Products","auth","req","res","method","getProducts","createProduct","APIfeatures","constructor","query","queryString","filtering","queryObj","excludeFields","forEach","el","category","find","title","$regex","sorting","sort","sortBy","split","join","paginating","page","limit","skip","features","products","json","status","result","length","err","message","role","price","inStock","description","content","images","body","newProduct","toLowerCase","save","msg"],"sources":["C:/Users/gihanmadhuwantha/Desktop/system_Development/AththanayakaFoods/aththanayakafoods/pages/api/product/index.js"],"sourcesContent":["import connectDB from '../../../utils/connectDB'\r\nimport Products from '../../../models/productModel'\r\nimport auth from '../../../middleware/auth'\r\n\r\nconnectDB()\r\nexport default async(req,res)=>{\r\n switch(req.method){\r\n    case \"GET\":\r\n        await getProducts(req,res)\r\n        break;\r\n        case \"POST\":\r\n         await createProduct(req, res)\r\n         break;\r\n\r\n }\r\n class APIfeatures {\r\n    constructor(query, queryString){\r\n        this.query = query;\r\n        this.queryString = queryString;\r\n    }\r\n    filtering(){\r\n        const queryObj = {...this.queryString}\r\n\r\n        const excludeFields = ['page', 'sort', 'limit']\r\n        excludeFields.forEach(el => delete(queryObj[el]))\r\n\r\n        if(queryObj.category !== 'all')\r\n            this.query.find({category: queryObj.category})\r\n        if(queryObj.title !== 'all')\r\n            this.query.find({title: {$regex: queryObj.title}})\r\n\r\n        this.query.find()\r\n        return this;\r\n    }\r\n\r\n    sorting(){\r\n        if(this.queryString.sort){\r\n            const sortBy = this.queryString.sort.split(',').join('')\r\n            this.query = this.query.sort(sortBy)\r\n        }else{\r\n            this.query = this.query.sort('-createdAt')\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    paginating(){\r\n        const page = this.queryString.page * 1 || 1\r\n        const limit = this.queryString.limit * 1 || 6\r\n        const skip = (page - 1) * limit;\r\n        this.query = this.query.skip(skip).limit(limit)\r\n        return this;\r\n    }\r\n}\r\n\r\n}\r\nconst getProducts= async(req,res)=>{\r\n try {\r\n    const features = new APIfeatures(Products.find(), req.query)\r\n        .filtering().sorting().paginating()\r\n\r\n        const products = await features.query\r\n    \r\n    //const products=await Products.find()\r\n    res.json({\r\n        status:'success',\r\n        result:products.length,\r\n        products})\r\n } catch (err) {\r\n    return res.status(500).json({err:err.message })\r\n }\r\n}\r\nconst createProduct = async (req, res) => {\r\n   try {\r\n       const result = await auth(req, res)\r\n       if(result.role !== 'admin') return res.status(400).json({err: 'Authentication is not valid.'})\r\n\r\n       const {title, price, inStock, description, content, category, images} = req.body\r\n\r\n       if(!title || !price || !inStock || !description || !content || category === 'all' || images.length === 0)\r\n       return res.status(400).json({err: 'Please add all the fields.'})\r\n\r\n\r\n       const newProduct = new Products({\r\n           title: title.toLowerCase(), price, inStock, description, content, category, images\r\n       })\r\n\r\n       await newProduct.save()\r\n\r\n       res.json({msg: 'Success! Created a new product'})\r\n\r\n   } catch (err) {\r\n       return res.status(500).json({err: err.message})\r\n   }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}