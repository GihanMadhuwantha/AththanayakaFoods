{"ast":null,"code":"/* \r\nimport { getData } from '../utils/fetchData'\r\nimport { useState, useContext, useEffect } from 'react'\r\nimport Head from 'next/head'\r\nimport ProductItem from '../components/product/ProductItem'\r\nimport HeroSection from '../components/HeroSection'\r\nimport {useRouter} from 'next/router'\r\nimport {DataContext} from '../store/GlobalState'\r\nimport Filter from '../components/Filter'\r\n\r\n\r\nconst Home=(props)=>{\r\n   const [products, setProducts] = useState(props.products)\r\n   const [isCheck, setIsCheck] = useState(false)\r\n   const router = useRouter()\r\n\r\n  const {state, dispatch} = useContext(DataContext)\r\n  const {auth} = state\r\n  const [page, setPage] = useState(1)\r\n\r\n   const handleCheck = (id) => {\r\n    products.forEach(product => {\r\n      if(product._id === id) product.checked = !product.checked\r\n    })\r\n    setProducts([...products])\r\n  }\r\n  \r\n  const handleCheckALL = () => {\r\n    products.forEach(product => product.checked = !isCheck)\r\n    setProducts([...products])\r\n    setIsCheck(!isCheck)\r\n  }\r\n \r\n  const handleDeleteAll = () => {\r\n    let deleteArr = [];\r\n    products.forEach(product => {\r\n      if(product.checked){\r\n          deleteArr.push({\r\n            data: '', \r\n            id: product._id, \r\n            title: 'Delete all selected products?', \r\n            type: 'DELETE_PRODUCT'\r\n          })\r\n      }\r\n    })\r\n\r\n    dispatch({type: 'ADD_MODAL', payload: deleteArr})\r\n  }\r\n  const handleLoadmore = () => {\r\n    setPage(page + 1)\r\n    filterSearch({router, page: page + 1})\r\n  }\r\n  useEffect(() => {\r\n    setProducts(props.products)\r\n  },[props.products])\r\n  useEffect(() => {\r\n    if(Object.keys(router.query).length === 0) setPage(1)\r\n  },[router.query])\r\nreturn(\r\n  <div className=\"home_page\">\r\n  <HeroSection/>\r\n  <Filter state={state} />\r\n  {\r\n        auth.user && auth.user.role === 'admin' &&\r\n        <div className=\"delete_all btn btn-danger mt-2\" style={{marginBottom: '-10px'}}>\r\n          <input type=\"checkbox\" checked={isCheck} onChange={handleCheckALL}\r\n          style={{width: '25px', height: '25px', transform: 'translateY(8px)'}} />\r\n\r\n          <button className=\"btn btn-danger ml-2\"\r\n          data-toggle=\"modal\" data-target=\"#exampleModal\"\r\n          onClick={handleDeleteAll}>\r\n            DELETE ALL\r\n          </button>\r\n        </div>\r\n      }\r\n<div className=\"products\">\r\n      <Head>\r\n        <title>Home Page</title>\r\n      </Head>\r\n      \r\n     \r\n      \r\n      {\r\n          products.length === 0 \r\n          ? <h2>No Products</h2>\r\n\r\n          : products.map(product => (\r\n            <ProductItem key={product._id} product={product} handleCheck={handleCheck} />\r\n          ))\r\n        }\r\n      \r\n</div>\r\n  {\r\n        props.result < page * 6 ? \"\"\r\n        : <button className=\"btn btn-outline-info d-block mx-auto mb-4\"\r\n        onClick={handleLoadmore}>\r\n          Load more\r\n        </button>\r\n      }\r\n</div>\r\n)\r\n}\r\nexport async function getServerSideProps({query}) {\r\n  const page = query.page || 1\r\n  const category = query.category || 'all'\r\n  const sort = query.sort || ''\r\n  const search = query.search || 'all'\r\n\r\n  const res = await getData(\r\n    `product?limit=${page * 6}&category=${category}&sort=${sort}&title=${search}`\r\n  )\r\n  // server side rendering\r\n  return {\r\n    props: {\r\n      products: res.products,\r\n      result: res.result\r\n    }, // will be passed to the page component as props\r\n  }\r\n\r\n}\r\nexport default Home */","map":{"version":3,"names":[],"sources":["C:/Users/gihanmadhuwantha/Desktop/system_Development/AththanayakaFoods/aththanayakafoods/pages/index.js"],"sourcesContent":["/* \r\nimport { getData } from '../utils/fetchData'\r\nimport { useState, useContext, useEffect } from 'react'\r\nimport Head from 'next/head'\r\nimport ProductItem from '../components/product/ProductItem'\r\nimport HeroSection from '../components/HeroSection'\r\nimport {useRouter} from 'next/router'\r\nimport {DataContext} from '../store/GlobalState'\r\nimport Filter from '../components/Filter'\r\n\r\n\r\nconst Home=(props)=>{\r\n   const [products, setProducts] = useState(props.products)\r\n   const [isCheck, setIsCheck] = useState(false)\r\n   const router = useRouter()\r\n\r\n  const {state, dispatch} = useContext(DataContext)\r\n  const {auth} = state\r\n  const [page, setPage] = useState(1)\r\n\r\n   const handleCheck = (id) => {\r\n    products.forEach(product => {\r\n      if(product._id === id) product.checked = !product.checked\r\n    })\r\n    setProducts([...products])\r\n  }\r\n  \r\n  const handleCheckALL = () => {\r\n    products.forEach(product => product.checked = !isCheck)\r\n    setProducts([...products])\r\n    setIsCheck(!isCheck)\r\n  }\r\n \r\n  const handleDeleteAll = () => {\r\n    let deleteArr = [];\r\n    products.forEach(product => {\r\n      if(product.checked){\r\n          deleteArr.push({\r\n            data: '', \r\n            id: product._id, \r\n            title: 'Delete all selected products?', \r\n            type: 'DELETE_PRODUCT'\r\n          })\r\n      }\r\n    })\r\n\r\n    dispatch({type: 'ADD_MODAL', payload: deleteArr})\r\n  }\r\n  const handleLoadmore = () => {\r\n    setPage(page + 1)\r\n    filterSearch({router, page: page + 1})\r\n  }\r\n  useEffect(() => {\r\n    setProducts(props.products)\r\n  },[props.products])\r\n  useEffect(() => {\r\n    if(Object.keys(router.query).length === 0) setPage(1)\r\n  },[router.query])\r\nreturn(\r\n  <div className=\"home_page\">\r\n  <HeroSection/>\r\n  <Filter state={state} />\r\n  {\r\n        auth.user && auth.user.role === 'admin' &&\r\n        <div className=\"delete_all btn btn-danger mt-2\" style={{marginBottom: '-10px'}}>\r\n          <input type=\"checkbox\" checked={isCheck} onChange={handleCheckALL}\r\n          style={{width: '25px', height: '25px', transform: 'translateY(8px)'}} />\r\n\r\n          <button className=\"btn btn-danger ml-2\"\r\n          data-toggle=\"modal\" data-target=\"#exampleModal\"\r\n          onClick={handleDeleteAll}>\r\n            DELETE ALL\r\n          </button>\r\n        </div>\r\n      }\r\n<div className=\"products\">\r\n      <Head>\r\n        <title>Home Page</title>\r\n      </Head>\r\n      \r\n     \r\n      \r\n      {\r\n          products.length === 0 \r\n          ? <h2>No Products</h2>\r\n\r\n          : products.map(product => (\r\n            <ProductItem key={product._id} product={product} handleCheck={handleCheck} />\r\n          ))\r\n        }\r\n      \r\n</div>\r\n  {\r\n        props.result < page * 6 ? \"\"\r\n        : <button className=\"btn btn-outline-info d-block mx-auto mb-4\"\r\n        onClick={handleLoadmore}>\r\n          Load more\r\n        </button>\r\n      }\r\n</div>\r\n)\r\n}\r\nexport async function getServerSideProps({query}) {\r\n  const page = query.page || 1\r\n  const category = query.category || 'all'\r\n  const sort = query.sort || ''\r\n  const search = query.search || 'all'\r\n\r\n  const res = await getData(\r\n    `product?limit=${page * 6}&category=${category}&sort=${sort}&title=${search}`\r\n  )\r\n  // server side rendering\r\n  return {\r\n    props: {\r\n      products: res.products,\r\n      result: res.result\r\n    }, // will be passed to the page component as props\r\n  }\r\n\r\n}\r\nexport default Home */\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"},"metadata":{},"sourceType":"script"}